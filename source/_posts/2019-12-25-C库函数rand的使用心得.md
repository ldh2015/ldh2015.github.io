---
title: C库函数-rand()使用心得
tags: C库函数
categories: C/C++编程
---

伪随机数: 随机数函数产生的是通过公式计算出来的一系列伪随机数，这个公式会采用一个种子数计算出一个数，而该数将成为产生下一个数的种子数。

<!-- more -->

# rand,srand生成伪随机数

```c
#include <stdlib.h>
#include <time.h>

//种子相同，每次生成的序列也是相同的
srand(1);
//使用时一般使用time生成随机种子
//srand((unsigned int)time(NULL));
for(int i = 0; i < 10; i++)
{
    //生成0~99范围内的10个伪随机数
    printf("%d\t", rand() % 100);
}
```

# rand在windows和Linux下的区别

#### RAND_MAX的不同

Windows下：

/* Maximum value that can be returned by the rand function. */

\#define RAND_MAX 0x7fff

Linux下:

/* The largest number rand will return (same as INT_MAX). */
\#define RAND_MAX 2147483647

由于RAND_MAX不同，所以在两个平台下使用同一个种子会产生不同的随机数。

#### 多线程下的不同

Windows下:（在vs2015下测试，网上看到很多人在windows上测试也是这种情况）

**srand,rand是线程独立的。**

对于多线程来说，若未对各个线程进行 srand()，则各线程中rand() 的输出是一样的；同理，若各个线程同时批量调用 srand ( unsigned ( time(NULL))) 也是不行的，因为种子可能相同。

解决方法是对各个线程使用不同的种子，比如GetCurrentThreadId()，以当前线程ID为种子。

Linux下: (在ubuntu下使用gcc 4.9.4)

**srand,rand是线程共享的。**

多线程和单线程使用是一样的，只需要程序开始是设置一次srand(),后续所有线程调用rand()时都是根据上一次rand()的结果生成本次的结果。是线程安全的（看到glibc中rand()内部有lock）。



# rand种子如何选择

1,使用定值,如srand(2);

2,使用time(NULL)；精确到秒级

3, 使用 struct timeb stb精确到毫秒级别;

ftime(&stb);

srand((unsigned)stb.millitm);)

4, windows下还可使用函数QueryPerformanceCounter可以返回高精度的计数器值，其精度可达微秒级。

5, 使用当前线程ID



